(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{370:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"镜像操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("镜像操作")])]),s._v(" "),a("h3",{attrs:{id:"镜像名称"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像名称"}},[s._v("#")]),s._v(" "),a("strong",[s._v("镜像名称")])]),s._v(" "),a("p",[s._v("镜名称一般分两部分组成："),a("code",[s._v("[repository]:[tag]")]),s._v("。")]),s._v(" "),a("p",[s._v("在没有指定"),a("code",[s._v("tag")]),s._v("时，默认是"),a("code",[s._v("latest")]),s._v("，代表最新版本的镜像。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/U3X66g1k-vDIsmt3igeIiUDzxEwGPn3F3KyPdG2CeIw.png",alt:"image"}})]),s._v(" "),a("p",[s._v("这里的"),a("code",[s._v("mysql")]),s._v("就是"),a("code",[s._v("repository")]),s._v("，"),a("code",[s._v("5.7")]),s._v("就是"),a("code",[s._v("tag")]),s._v("，合一起就是镜像名称，代表5.7版本的MySQL镜像。")]),s._v(" "),a("h3",{attrs:{id:"镜像命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像命令"}},[s._v("#")]),s._v(" "),a("strong",[s._v("镜像命令")])]),s._v(" "),a("p",[s._v("帮助文档")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看帮助文档，会列出docker所有的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看某个命令的详解")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("镜像操作命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" URL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPOSITORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送镜像到服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从服务拉取镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("@DIGEST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存镜像为一个压缩包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载压缩包为镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/v-Ki-Z4H5KrdthTfBN3CY0_TFZpnqhh8_2imvXWFlPc.png",alt:"image"}})]),s._v(" "),a("h4",{attrs:{id:"下载nginx镜像-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载nginx镜像-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("下载Nginx镜像[例]")])]),s._v(" "),a("p",[s._v("镜像仓库地址："),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.docker.com/"),a("OutboundLink")],1)]),s._v(" "),a("h5",{attrs:{id:"搜索需要的镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搜索需要的镜像"}},[s._v("#")]),s._v(" 搜索需要的镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/GOt5g2G8Pq7LfH01GRR64SMQC8NQ_F14TzTkyw_HPgg.png",alt:"image"}})]),s._v(" "),a("h5",{attrs:{id:"使用推荐命令-或者指定版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用推荐命令-或者指定版本"}},[s._v("#")]),s._v(" 使用推荐命令，或者指定版本")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/wCGt5sIRzQtAKrEoTxUfXzpd0NP9gRa2CcXaj3uFRgM.png",alt:"image"}})]),s._v(" "),a("h5",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"查看镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像"}},[s._v("#")]),s._v(" 查看镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"导出镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像"}},[s._v("#")]),s._v(" 导出镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" nginx.tar nginx:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"删除镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除镜像"}},[s._v("#")]),s._v(" 删除镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi nginx:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"加载打包好的镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载打包好的镜像"}},[s._v("#")]),s._v(" 加载打包好的镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" nginx.tar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"镜像结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像结构"}},[s._v("#")]),s._v(" "),a("strong",[s._v("镜像结构")])]),s._v(" "),a("p",[s._v("镜像是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/qaSIB0pv0Ynn8hMPDzBoKxELofqiexfNNskPW1tFBro.png",alt:"image"}})]),s._v(" "),a("p",[s._v("简单来说，镜像就是在系统函数库、运行环境基础上，添加应用程序文件、配置文件、依赖文件等组合，然后编写好启动脚本打包在一起形成的文件。")]),s._v(" "),a("p",[s._v("构建镜像，其实就是实现上述打包的过程。")]),s._v(" "),a("h3",{attrs:{id:"dockerfile语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile语法"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Dockerfile语法")])]),s._v(" "),a("p",[s._v("构建自定义的镜像时，并不需要一个个文件去拷贝，打包。")]),s._v(" "),a("p",[s._v("只需要告诉Docker镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，Docker就会构建镜像。")]),s._v(" "),a("p",[s._v("而描述上述信息的文件就是"),a("code",[s._v("Dockerfile")]),s._v("文件。")]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile的本质是一个文件，通过指令描述镜像的构建过程")]),s._v(" "),a("li",[s._v("Dockerfile的第一行必须是FROM，从一个基础镜像来构建")]),s._v(" "),a("li",[s._v("基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine")])]),s._v(" "),a("p",[a("strong",[s._v("Dockerfile")]),s._v("就是一个文本文件，其中包含一个个的"),a("strong",[s._v("指令(Instruction)")]),s._v("，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/LkKoRrIjP6m20G1gpAhCSCnYJ-EE-sg-AwgDi_HNv48.png",alt:"image"}})]),s._v(" "),a("p",[s._v("官网文档： "),a("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/engine/reference/builder"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"构建java项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建java项目"}},[s._v("#")]),s._v(" "),a("strong",[s._v("构建Java项目")])]),s._v(" "),a("h4",{attrs:{id:"基于ubuntu镜像构建-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于ubuntu镜像构建-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("基于Ubuntu镜像构建[例]")])]),s._v(" "),a("p",[s._v("创建一个文件夹，将JDK和jar包文件放入该文件夹下，还有写好的Dockerfile文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/JNZfQB7XDo_ckrDMQNFGIA5NcNLUod8pjXf0cRujNbs.png",alt:"image"}})]),s._v(" "),a("h5",{attrs:{id:"dockerfile文件内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile文件内容"}},[s._v("#")]),s._v(" Dockerfile文件内容")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("# 指定基础镜像\nFROM ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.04")]),s._v("\n# 配置环境变量，JDK的安装目录\nENV JAVA_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local\n\n# 拷贝jdk和java项目的包\nCOPY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jdk8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("gz $JAVA_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar\n\n# 安装JDK\nRUN "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cd")]),s._v(" $JAVA_DIR \\\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jdk8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("tar"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("gz \\\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mv "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jdk1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("0_144 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java8\n\n# 配置环境变量\nENV JAVA_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$JAVA_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java8\nENV PATH"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$PATH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),s._v("\n\n# 暴露端口\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v("\n# 入口，java项目的启动命令\nENTRYPOINT java "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h5",{attrs:{id:"构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" javaweb:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t：镜像的名字和版本号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .：dockerfile所在的目录，因为这里就在当前目录，所以写个 .")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v(":8090 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" javaweb:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"基于java8构建-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于java8构建-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("基于java8构建[例]")])]),s._v(" "),a("p",[s._v("虽然可以基于Ubuntu基础镜像，添加任意安装包，构建镜像，但是却比较麻烦。大多数情况下，可以在一些安装了部分软件的基础镜像上做改造。")]),s._v(" "),a("p",[s._v("构建java项目的镜像，可以在已经准备了JDK的基础镜像基础上构建。基于java:8-alpine镜像。")]),s._v(" "),a("h5",{attrs:{id:"dockerfile文件内容-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile文件内容-2"}},[s._v("#")]),s._v(" Dockerfile文件内容")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("FROM java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alpine\nCOPY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v("\nENTRYPOINT java "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("其他的操作和上面的一样。")]),s._v(" "),a("h3",{attrs:{id:"搭建镜像仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建镜像仓库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("搭建镜像仓库")])]),s._v(" "),a("h4",{attrs:{id:"简化版仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简化版仓库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("简化版仓库")])]),s._v(" "),a("p",[s._v("Docker官方的Docker Registry是一个基础版本的Docker镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。")]),s._v(" "),a("p",[s._v("命令如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" registry\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" registry-data:/var/lib/registry "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    registry\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("命令中挂载了一个数据卷registry-data到容器内的"),a("code",[s._v("/var/lib/registry")]),s._v("目录，这是私有镜像库存放数据的目录。")]),s._v(" "),a("p",[s._v("访问"),a("code",[s._v("http://YourIp:5000/v2/_catalog")]),s._v("可以查看当前私有镜像服务中包含的镜像。")]),s._v(" "),a("h4",{attrs:{id:"图形化界面仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图形化界面仓库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("图形化界面仓库")])]),s._v(" "),a("p",[s._v("使用DockerCompose部署带有图象界面的DockerRegistry，命令如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.0'")]),s._v("\nservices:\n  registry:\n    image: registry\n    volumes:\n      - ./registry-data:/var/lib/registry\n  ui:\n    image: joxit/docker-registry-ui:static\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":80\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REGISTRY_TITLE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("乔木先生私有仓库\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REGISTRY_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://registry:5000\n    depends_on:\n      - registry\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"配置信任地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置信任地址"}},[s._v("#")]),s._v(" "),a("strong",[s._v("配置信任地址")])]),s._v(" "),a("p",[s._v("私服采用的是http协议，默认不被Docker信任，所以需要做一个配置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开要修改的文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加内容：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.120.100:5000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重加载")]),s._v("\nsystemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("如果这里还报错：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/wq9SCu559Zl3TFvrBwJmh26V18PcmNZ5y-bmB_WpNSc.png",alt:"image"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Get "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.120.100:5000/v2/"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" http: server gave HTTP response to HTTPS client\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在下面的文件中，第13行左右增加"),a("code",[s._v("--insecure-registry ip地址:端口号")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/docker.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/pyIB320Gx28VPo2vAqsz_kVo64Fr1D7f_H8hgD7xt7o.png",alt:"image"}})]),s._v(" "),a("p",[s._v("然后重启docker即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载")]),s._v("\nsystemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("最后进入放置docker-compose.yml的文件夹中执行命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"推送、拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送、拉取镜像"}},[s._v("#")]),s._v(" "),a("strong",[s._v("推送、拉取镜像")])]),s._v(" "),a("p",[s._v("推送镜像到私有镜像服务必须先tag，步骤如下：")]),s._v(" "),a("p",[s._v("① 重新tag本地镜像，名称前缀为私有仓库的地址："),a("code",[s._v("192.168.120.100:5000/")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag nginx:latest "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8080/nginx:1.0 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("② 推送镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8080/nginx:1.0 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("③ 拉取镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8080/nginx:1.0 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);