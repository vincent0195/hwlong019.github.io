(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{369:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"数据卷操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("数据卷操作")])]),s._v(" "),a("p",[a("strong",[s._v("容器与数据（容器内文件）耦合：")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("不便于修改")]),s._v("：如果需要修改配置文件，需要进入容器的内部。")]),s._v(" "),a("li",[a("strong",[s._v("数据不可复用")]),s._v("：容器内的修改对外不可见，无法复用。")]),s._v(" "),a("li",[a("strong",[s._v("升级维护困难")]),s._v("：如果想要升级容器，需要先删除旧容器，数据也会被一起删除。")])]),s._v(" "),a("p",[s._v("**数据卷（volume）**是一个虚拟目录，指向宿主机文件系统中的某个目录。将容器与数据分离，解耦合，方便操作容器内数据，保证数据安全。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/yKkRFptNDMCr40P3BRG3_MWvg8m7tNXRKtJ0S_JBIeM.png",alt:"image"}})]),s._v(" "),a("p",[s._v("一旦完成数据卷挂载，对容器的一切操作都会作用在数据卷对应的宿主机目录了。")]),s._v(" "),a("p",[s._v("这样，操作宿主机的"),a("code",[s._v("/var/lib/docker/volumes/html")]),s._v("目录，就等于操作容器内的"),a("code",[s._v("/usr/share/nginx/html")]),s._v("目录了。")]),s._v(" "),a("h2",{attrs:{id:"操作数据卷命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作数据卷命令"}},[s._v("#")]),s._v(" "),a("strong",[s._v("操作数据卷命令")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COMMAND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建数据卷")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有数据卷")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看数据卷详细信息，包括关联的宿主机目录位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定数据卷")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有未使用的数据卷")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume prune\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("code",[s._v("docker volume")]),s._v("命令是数据卷操作，根据命令后跟随的"),a("code",[s._v("command")]),s._v("来确定下一步的操作：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("create")]),s._v("：创建一个volume")]),s._v(" "),a("li",[a("code",[s._v("inspect")]),s._v("：显示一个或多个volume的信息")]),s._v(" "),a("li",[a("code",[s._v("ls")]),s._v("：列出所有的volume")]),s._v(" "),a("li",[a("code",[s._v("prune")]),s._v("：删除未使用的volume")]),s._v(" "),a("li",[a("code",[s._v("rm")]),s._v("：删除一个或多个指定的volume")])]),s._v(" "),a("h3",{attrs:{id:"操作数据卷-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作数据卷-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("操作数据卷[例]")])]),s._v(" "),a("h5",{attrs:{id:"创建数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建数据卷"}},[s._v("#")]),s._v(" 创建数据卷")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" vilume html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"查看数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看数据卷"}},[s._v("#")]),s._v(" 查看数据卷")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"查看数据卷的详细信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看数据卷的详细信息"}},[s._v("#")]),s._v(" 查看数据卷的详细信息")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"删除未使用的数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除未使用的数据卷"}},[s._v("#")]),s._v(" 删除未使用的数据卷")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume prune\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"删除指定数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除指定数据卷"}},[s._v("#")]),s._v(" 删除指定数据卷")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"挂载数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载数据卷"}},[s._v("#")]),s._v(" "),a("strong",[s._v("挂载数据卷")])]),s._v(" "),a("p",[s._v("在创建容器时，可以通过"),a("code",[s._v("-v")]),s._v("参数来挂载一个数据卷到某个容器内目录，命令格式如下：")]),s._v(" "),a("p",[s._v("举例：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mn "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" html:/root/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80\n  nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("-v html:/root/htm")]),s._v("：把html数据卷挂载到容器内的/root/html这个目录中")])]),s._v(" "),a("h3",{attrs:{id:"挂载nginx数据卷-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载nginx数据卷-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("挂载Nginx数据卷[例]")])]),s._v(" "),a("p",[s._v("如果html数据卷不存在，会直接创建数据卷。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nginx    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" html:/usr/share/nginx/html    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    nginx    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("然后使用查看数据卷命令，可以看到数据卷的位置，可以在该位置修改相关文件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/pbAHTF2DksVTdJ5YqsUn3xkYeNB2obIuQwEoRQFbmwc.png",alt:"image"}})]),s._v(" "),a("h2",{attrs:{id:"直接挂载数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直接挂载数据卷"}},[s._v("#")]),s._v(" "),a("strong",[s._v("直接挂载数据卷")])]),s._v(" "),a("p",[s._v("容器不仅仅可以挂载数据卷，也可以直接挂载到宿主机目录上。关联关系如下：")]),s._v(" "),a("ul",[a("li",[s._v("**带数据卷模式：**宿主机目录 ---\x3e 数据卷 ---\x3e 容器内目录")]),s._v(" "),a("li",[s._v("**直接挂载模式：**宿主机目录 ---\x3e 容器内目录")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://qaomuu-blog.oss-cn-hangzhou.aliyuncs.com/soSRpziLU6egqt70vxo6plDLwlfttiiWG2MOTHv5HU4.png",alt:"image"}})]),s._v(" "),a("p",[s._v("目录挂载与数据卷挂载的语法是类似的：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-v [宿主机目录]:[容器内目录]")])]),s._v(" "),a("li",[a("code",[s._v("-v [宿主机文件]:[容器内文件]")])])]),s._v(" "),a("p",[a("strong",[s._v("数据卷挂载与目录直接挂载的区别")])]),s._v(" "),a("ul",[a("li",[s._v("数据卷挂载耦合度低，由docker来管理目录，但是目录较深，不好找")]),s._v(" "),a("li",[s._v("目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看")])]),s._v(" "),a("h3",{attrs:{id:"直接挂载mysql数据卷-例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直接挂载mysql数据卷-例"}},[s._v("#")]),s._v(" "),a("strong",[s._v("直接挂载MySQL数据卷[例]")])]),s._v(" "),a("h5",{attrs:{id:"拉取mysql镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取mysql镜像"}},[s._v("#")]),s._v(" 拉取MySQL镜像")]),s._v(" "),a("div",{staticClass:"language-Plain Text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("docker pull mysql:8.0.29\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"创建mysql的相关目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建mysql的相关目录"}},[s._v("#")]),s._v(" 创建MySQL的相关目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/var/lib/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"启动并挂载mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动并挂载mysql"}},[s._v("#")]),s._v(" 启动并挂载MySQL")]),s._v(" "),a("p",[s._v("这里挂载三个目录，一个日志目录，一个数据目录，一个配置目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mysql    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/lib/mysql/log:/var/log/mysql    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/lib/mysql/data:/var/lib/mysql    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /var/lib/mysql/conf:/etc/mysql/conf.d    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root1019    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    mysql:8.0.29    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);